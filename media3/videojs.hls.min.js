/*! videojs-contrib-hls - v0.5.0 - 2014-04-18
* Copyright (c) 2014 Brightcove; Licensed  */
!function(a,b,c,d){b.hls={supportsNativeHls:function(){var a,d,e=c.createElement("video");return b.Html5.isSupported()?(a=e.canPlayType("application/x-mpegURL"),d=e.canPlayType("application/vnd.apple.mpegURL"),/probably|maybe/.test(a)||/probably|maybe/.test(d)):!1}()};var e,f=5,g=1.1,h=function(b,c){var d,e;return b.attributes&&b.attributes.BANDWIDTH&&(d=b.attributes.BANDWIDTH),d=d||a.Number.MAX_VALUE,c.attributes&&c.attributes.BANDWIDTH&&(e=c.attributes.BANDWIDTH),e=e||a.Number.MAX_VALUE,d-e},i=function(b,c){var d,e;return b.attributes&&b.attributes.RESOLUTION&&b.attributes.RESOLUTION.width&&(d=b.attributes.RESOLUTION.width),d=d||a.Number.MAX_VALUE,c.attributes&&c.attributes.RESOLUTION&&c.attributes.RESOLUTION.width&&(e=c.attributes.RESOLUTION.width),e=e||a.Number.MAX_VALUE,d===e&&b.attributes.BANDWIDTH&&c.attributes.BANDWIDTH?b.attributes.BANDWIDTH-c.attributes.BANDWIDTH:d-e},j=function(c,d){var f,g={method:"GET"};return"function"!=typeof d&&(d=function(){}),"object"==typeof c&&(g=b.util.mergeOptions(g,c),c=g.url),f=new a.XMLHttpRequest,f.open(g.method,c),g.responseType&&(f.responseType=g.responseType),e.withCredentials&&(f.withCredentials=!0),f.onreadystatechange=function(){return 4===this.readyState?this.status>=400||0===this.status?d.call(this,!0,c):d.call(this,!1,c):void 0},f.send(null),f},k=function(a,b){var c,d,e,f;for(e=[],c=0;c<a.segments.length;c++)f={},f.start=0===c?0:e[c-1].end,f.end=f.start+a.segments[c].duration,e.push(f);for(d=0;d<e.length;d++)if(b>=e[d].start&&b<e[d].end)return d;return-1},l=function(a,b,c){var d,e=c.segments.length;if(0===a)return 0;for(d=b.segments[a-1];e--;)if(d.uri===c.segments[e].uri)return e+1;return b.mediaSequence+a-c.mediaSequence},m=function(b){var c,d=0,e=(b.segments||[]).length;if(b.totalDuration)return b.totalDuration;if(!b.endList)return a.Infinity;for(;e--;)c=b.segments[e],d+=c.duration||b.targetDuration||0;return d},n=function(a,b){var d,e,f=c.querySelector("base"),g=c.querySelector("head"),h=c.createElement("a"),i=f;return f?d=f.href:i=g.appendChild(c.createElement("base")),i.href=a,h.href=b,e=h.href,f?f.href=d:g.removeChild(i),e},o=function(c){var o,p,q,r,s,t,u,v=new b.MediaSource,w=new b.hls.SegmentParser,x=this;if(!b.hls.supportsNativeHls){if(e=b.util.mergeOptions({},c),o=function(){var a,d,e=0,f=0,g=x.el().querySelector(".vjs-tech").src,h=x.options().sources,i=h.length;if("string"==typeof c)return c;if(c&&c.url)return c.url;if(g){if(a=/[^#?]*(?:\/[^#?]*\.([^#?]*))/.exec(g),a&&"m3u8"===a[1])return g}else for(;i>e;e++)if(h[e].type){for(f in x.options().techOrder)if(d=x.options().techOrder[f],d=d[0].toUpperCase()+d.substring(1),b[d].canPlaySource({type:h[e].type}))return;if(/application\/x-mpegURL/.test(h[e].type)||/application\/vnd\.apple\.mpegURL/.test(h[e].type))return h[e].src}}(),!o)return void b.log("hls: no valid playlist URL specified");x.hls.readyState=function(){return x.hls.media?1:0},x.on("seeking",function(){var a=x.currentTime();x.hls.mediaIndex=k(x.hls.media,a),x.hls.sourceBuffer.abort(),q&&q.abort(),s(1e3*a)}),u=function(a){var b;x.duration(m(a)),b=x.el().querySelector(".vjs-tech"),b.vjs_setProperty&&b.vjs_setProperty("duration",x.duration()),x.trigger("durationchange")},t=function(){var a,b;a=x.hls.selectPlaylist(),b=x.hls.mediaIndex+(x.hls.media.mediaSequence||0),!a.segments||b<(a.mediaSequence||0)||b>(a.mediaSequence||0)+a.segments.length?(p&&p.abort(),p=j(n(o,a.uri),r)):(x.hls.mediaIndex=l(x.hls.mediaIndex,x.hls.media,a),x.hls.media=a,u(x.hls.media))},x.hls.selectPlaylist=function(){var a,b,c,d,e=x.hls.master.playlists.slice(),f=[],j=e.length;for(e.sort(h);j--;)b=e[j],b.attributes&&b.attributes.BANDWIDTH&&(a=b.attributes.BANDWIDTH*g,a<x.hls.bandwidth&&(f.push(b),c||(c=b)));for(j=f.length,f.sort(i);j--;)if(b=f[j],b.attributes&&b.attributes.RESOLUTION&&b.attributes.RESOLUTION.width&&b.attributes.RESOLUTION.height&&b.attributes.RESOLUTION.width<=x.width()&&b.attributes.RESOLUTION.height<=x.height()){d=b;break}return d||c||e[0]},r=function(c,d){var e,f,g,h,i;if(p=null,c)return x.hls.error={status:this.status,message:"HLS playlist request error at URL: "+d,code:this.status>=500?4:2},x.trigger("error");for(f=new b.m3u8.Parser,f.push(this.responseText),e=x.hls.master.playlists.length,i=1e3*(f.manifest.targetDuration||10);e--;)if(g=x.hls.master.playlists[e],h=n(o,g.uri),h===d){if(g.segments&&g.segments.length===f.manifest.segments.length&&(i/=2),x.hls.master.playlists[e]=b.util.mergeOptions(g,f.manifest),g!==x.hls.media)continue;x.hls.mediaIndex=l(x.hls.mediaIndex,g,f.manifest),x.hls.media=f.manifest}return f.manifest.endList||a.setTimeout(function(){p||n(o,x.hls.media.uri)!==d||(p=j(d,r))},i),x.hls.media?(t(),void x.trigger("loadedmanifest")):(x.hls.media=x.hls.master.playlists[0],u(f.manifest),x.on("timeupdate",s),x.trigger("loadedmanifest"),x.trigger("loadedmetadata"),void s())},s=function(a){var b,c,e,g=x.buffered(),h=0;q||x.hls.media.segments&&(b=x.hls.media.segments[x.hls.mediaIndex],b&&(g&&(h=x.buffered().end(0)-x.currentTime()),h>=f||(c=x.hls.media.uri===o?n(o,b.uri):n(n(o,x.hls.media.uri||""),b.uri),e=+new Date,q=j({url:c,responseType:"arraybuffer"},function(b,c){if(q=null,b)return x.hls.error={status:this.status,message:"HLS segment request error at URL: "+c,code:this.status>=500?4:2},void x.hls.mediaIndex++;if(this.response){if(x.hls.segmentXhrTime=+new Date-e,x.hls.bandwidth=this.response.byteLength/x.hls.segmentXhrTime*8*1e3,w.parseSegmentBinaryData(new Uint8Array(this.response)),w.flushTags(),a!==d&&"number"==typeof a)for(;w.getTags()[0].pts<a;)w.getNextTag();for(;w.tagsAvailable();)x.hls.sourceBuffer.appendBuffer(w.getNextTag().bytes,x);x.hls.mediaIndex++,x.hls.mediaIndex===x.hls.media.segments.length&&v.endOfStream(),t()}}))))},v.addEventListener("sourceopen",function(){var c=v.addSourceBuffer('video/flv; codecs="vp6,aac"');x.hls.sourceBuffer=c,c.appendBuffer(w.getFlvHeader()),x.hls.mediaIndex=0,j(o,function(c,d){var e,f=new b.m3u8.Parser;return f.push(this.responseText),f.manifest.playlists?(x.hls.master=f.manifest,p=j(n(d,f.manifest.playlists[0].uri),r),x.trigger("loadedmanifest")):(e=n(a.location.href,d),x.hls.master={playlists:[{uri:e}]},r.call(this,c,e),void 0)})}),x.src([{src:b.URL.createObjectURL(v),type:"video/flv"}]),x.options().autoplay&&x.play()}};b.plugin("hls",function(){if("undefined"!=typeof Uint8Array){var a=function(){return function(){this.hls=a(),o.apply(this,arguments)}};a().apply(this,arguments)}})}(window,window.videojs,document),function(a){a.videojs=a.videojs||{},a.videojs.hls=a.videojs.hls||{};var b=a.videojs.hls;b.FlvTag=function(a,c){var d,e=0,f=function(a,b){var c,d=a.position+b;d<a.bytes.byteLength||(c=new Uint8Array(2*d),c.set(a.bytes.subarray(0,a.position),0),a.bytes=c,a.view=new DataView(a.bytes.buffer))},g=b.FlvTag.widthBytes||new Uint8Array("width".length),h=b.FlvTag.heightBytes||new Uint8Array("height".length),i=b.FlvTag.videocodecidBytes||new Uint8Array("videocodecid".length);if(!b.FlvTag.widthBytes){for(d in"width")g[d]="width".charCodeAt(d);for(d in"height")h[d]="height".charCodeAt(d);for(d in"videocodecid")i[d]="videocodecid".charCodeAt(d);b.FlvTag.widthBytes=g,b.FlvTag.heightBytes=h,b.FlvTag.videocodecidBytes=i}switch(this.keyFrame=!1,a){case b.FlvTag.VIDEO_TAG:this.length=16;break;case b.FlvTag.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case b.FlvTag.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw"Error Unknown TagType"}this.bytes=new Uint8Array(16384),this.view=new DataView(this.bytes.buffer),this.bytes[0]=a,this.position=this.length,this.keyFrame=c,this.pts=0,this.dts=0,this.writeBytes=function(a,b,c){var d,e=b||0;c=c||a.byteLength,d=e+c,f(this,c),this.bytes.set(a.subarray(e,d),this.position),this.position+=c,this.length=Math.max(this.length,this.position)},this.writeByte=function(a){f(this,1),this.bytes[this.position]=a,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(a){f(this,2),this.view.setUint16(this.position,a),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(a){return this.bytes[this.length-a]},this.nalUnitSize=function(){return 0===e?0:this.length-(e+4)},this.startNalUnit=function(){if(e>0)throw new Error("Attempted to create new NAL wihout closing the old one");e=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(a){var b,c;this.length===e+4?this.length-=4:e>0&&(b=e+4,c=this.length-b,this.position=e,this.view.setUint32(this.position,c),this.position=this.length,a&&a.push(this.bytes.subarray(b,b+c))),e=0},this.writeMetaDataDouble=function(a,b){var c;if(f(this,2+a.length+9),this.view.setUint16(this.position,a.length),this.position+=2,"width"===a)this.bytes.set(g,this.position),this.position+=5;else if("height"===a)this.bytes.set(h,this.position),this.position+=6;else if("videocodecid"===a)this.bytes.set(i,this.position),this.position+=12;else for(c in a)this.bytes[this.position]=a.charCodeAt(c),this.position++;this.position++,this.view.setFloat64(this.position,b),this.position+=8,this.length=Math.max(this.length,this.position),++e},this.writeMetaDataBoolean=function(a,b){var c;f(this,2),this.view.setUint16(this.position,a.length),this.position+=2;for(c in a)console.assert(a.charCodeAt(c)<255),f(this,1),this.bytes[this.position]=a.charCodeAt(c),this.position++;f(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,b?1:0),this.position++,this.length=Math.max(this.length,this.position),++e},this.finalize=function(){var a,d;switch(this.bytes[0]){case b.FlvTag.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||c?16:32),this.bytes[12]=c?0:1,a=this.pts-this.dts,this.bytes[13]=(16711680&a)>>>16,this.bytes[14]=(65280&a)>>>8,this.bytes[15]=(255&a)>>>0;break;case b.FlvTag.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=c?0:1;break;case b.FlvTag.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,e),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return d=this.length-11,this.bytes[1]=(16711680&d)>>>16,this.bytes[2]=(65280&d)>>>8,this.bytes[3]=(255&d)>>>0,this.bytes[4]=(16711680&this.pts)>>>16,this.bytes[5]=(65280&this.pts)>>>8,this.bytes[6]=(255&this.pts)>>>0,this.bytes[7]=(4278190080&this.pts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=b.FlvTag.frameTime(this.bytes),console.assert(this.bytes.byteLength===this.length),this}},b.FlvTag.AUDIO_TAG=8,b.FlvTag.VIDEO_TAG=9,b.FlvTag.METADATA_TAG=18,b.FlvTag.isAudioFrame=function(a){return b.FlvTag.AUDIO_TAG===a[0]},b.FlvTag.isVideoFrame=function(a){return b.FlvTag.VIDEO_TAG===a[0]},b.FlvTag.isMetaData=function(a){return b.FlvTag.METADATA_TAG===a[0]},b.FlvTag.isKeyFrame=function(a){return b.FlvTag.isVideoFrame(a)?23===a[11]:b.FlvTag.isAudioFrame(a)?!0:b.FlvTag.isMetaData(a)?!0:!1},b.FlvTag.frameTime=function(a){var b=a[4]<<16;return b|=a[5]<<8,b|=a[6]<<0,b|=a[7]<<24}}(this),function(a){a.videojs.hls.ExpGolomb=function(a){var b=a.byteLength,c=0,d=0;this.length=function(){return 8*b},this.bitsAvailable=function(){return 8*b+d},this.loadWord=function(){var e=a.byteLength-b,f=new Uint8Array(4),g=Math.min(4,b);if(0===g)throw new Error("no bytes available");f.set(a.subarray(e,e+g)),c=new DataView(f.buffer).getUint32(0),d=8*g,b-=g},this.skipBits=function(a){var e;d>a?(c<<=a,d-=a):(a-=d,e=a/8,a-=8*e,b-=e,this.loadWord(),c<<=a,d-=a)},this.readBits=function(a){var e=Math.min(d,a),f=c>>>32-e;return console.assert(32>a,"Cannot read more than 32 bits at a time"),d-=e,d>0?c<<=e:b>0&&this.loadWord(),e=a-e,e>0?f<<e|this.readBits(e):f},this.skipLeadingZeros=function(){var a;for(a=0;d>a;++a)if(0!==(c&2147483648>>>a))return c<<=a,d-=a,a;return this.loadWord(),a+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var a=this.skipLeadingZeros();return this.readBits(a+1)-1},this.readExpGolomb=function(){var a=this.readUnsignedExpGolomb();return 1&a?1+a>>>1:-1*(a>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()}}(this),function(a){var b,c=a.videojs.hls.ExpGolomb,d=a.videojs.hls.FlvTag,e=function(){this.sps=[],this.pps=[],this.extraDataExists=function(){return this.sps.length>0},this.scaling_list=function(a,b){var c,d,e=8,f=8;for(c=0;a>c;++c)0!==f&&(d=b.readExpGolomb(),f=(e+d+256)%256),e=0===f?e:f},this.getSps0Rbsp=function(){for(var a=this.sps[0],b=1,c=1,d=0,e=a.byteLength-2,f=new Uint8Array(a.byteLength);e>b;)0===a[b]&&0===a[b+1]&&3===a[b+2]&&(f.set(a.subarray(c,b+1),d),d+=b+1-c,c=b+3),b++;return f.set(a.subarray(c),d),f.subarray(0,d+(a.byteLength-c))},this.metaDataTag=function(a){var b,e,f,g,h,i,j,k,l,m,n,o,p,q=new d(d.METADATA_TAG),r=0,s=0,t=0,u=0;if(q.dts=a,q.pts=a,b=new c(this.getSps0Rbsp()),e=b.readUnsignedByte(),b.skipBits(16),b.skipUnsignedExpGolomb(),(100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e)&&(f=b.readUnsignedExpGolomb(),3===f&&b.skipBits(1),b.skipUnsignedExpGolomb(),b.skipUnsignedExpGolomb(),b.skipBits(1),b.readBoolean()))for(g=3!==f?8:12,h=0;g>h;++h)b.readBoolean()&&(6>h?this.scaling_list(16,b):this.scaling_list(64,b));if(b.skipUnsignedExpGolomb(),i=b.readUnsignedExpGolomb(),0===i)b.readUnsignedExpGolomb();else if(1===i)for(b.skipBits(1),b.skipExpGolomb(),b.skipExpGolomb(),j=b.readUnsignedExpGolomb(),h=0;j>h;++h)b.skipExpGolomb();return b.skipUnsignedExpGolomb(),b.skipBits(1),k=b.readUnsignedExpGolomb(),l=b.readUnsignedExpGolomb(),m=b.readBits(1),0===m&&b.skipBits(1),b.skipBits(1),n=b.readBoolean(),n&&(r=b.readUnsignedExpGolomb(),s=b.readUnsignedExpGolomb(),t=b.readUnsignedExpGolomb(),u=b.readUnsignedExpGolomb()),o=16*(k+1)-2*r-2*s,p=(2-m)*(l+1)*16-2*t-2*u,q.writeMetaDataDouble("videocodecid",7),q.writeMetaDataDouble("width",o),q.writeMetaDataDouble("height",p),q},this.extraDataTag=function(a){var b,c=new d(d.VIDEO_TAG,!0);for(c.dts=a,c.pts=a,c.writeByte(1),c.writeByte(this.sps[0][1]),c.writeByte(this.sps[0][2]),c.writeByte(this.sps[0][3]),c.writeByte(255),c.writeByte(225),c.writeShort(this.sps[0].length),c.writeBytes(this.sps[0]),c.writeByte(this.pps.length),b=0;b<this.pps.length;++b)c.writeShort(this.pps[b].length),c.writeBytes(this.pps[b]);return c}};a.videojs.hls.NALUnitType=b={unspecified:0,slice_layer_without_partitioning_rbsp_non_idr:1,slice_data_partition_a_layer_rbsp:2,slice_data_partition_b_layer_rbsp:3,slice_data_partition_c_layer_rbsp:4,slice_layer_without_partitioning_rbsp_idr:5,sei_rbsp:6,seq_parameter_set_rbsp:7,pic_parameter_set_rbsp:8,access_unit_delimiter_rbsp:9,end_of_seq_rbsp:10,end_of_stream_rbsp:11},a.videojs.hls.H264Stream=function(){var a,c,f,g,h,i=new e,j=new e,k=-1;this.tags=[],this.setNextTimeStamp=function(b,d,e){f=b,this.setNextTimeStamp=function(b,d,e){a=b-f,c=d-f,e&&this.finishFrame()},this.setNextTimeStamp(b,d,e)},this.finishFrame=function(){g&&(j.extraDataExists()&&(i=j,j=new e),g.keyFrame&&(this.tags.push(i.metaDataTag(g.pts)),this.tags.push(i.extraDataTag(g.pts))),g.endNalUnit(),this.tags.push(g)),g=null,k=-1,h=0},this.writeBytes=function(e,f,i){var l,m,n,o;if(f=f||0,i=i||0,!(0>=i))switch(h){default:case 0:h=1;case 1:if(e[f]<=1&&(l=g?g.nalUnitSize():0,l>=1&&0===g.negIndex(1))){if(1===e[f]&&l>=2&&0===g.negIndex(2))return g.length-=l>=3&&0===g.negIndex(3)?3:2,h=3,this.writeBytes(e,f+1,i-1);if(i>1&&0===e[f]&&1===e[f+1])return g.length-=l>=2&&0===g.negIndex(2)?2:1,h=3,this.writeBytes(e,f+2,i-2);if(i>2&&0===e[f]&&0===e[f+1]&&1===e[f+2])return h=3,this.writeBytes(e,f+3,i-3)}h=2;case 2:for(m=f,n=m+i,o=n-3;o>f;)if(e[f+2]>1)f+=3;else if(0!==e[f+1])f+=2;else if(0!==e[f])f+=1;else{if(1===e[f+2])return f>m&&g.writeBytes(e,m,f-m),h=3,f+=3,this.writeBytes(e,f,n-f);if(n-f>=4&&0===e[f+2]&&1===e[f+3])return f>m&&g.writeBytes(e,m,f-m),h=3,f+=4,this.writeBytes(e,f,n-f);f+=3}return h=1,void g.writeBytes(e,m,i);case 3:if(g)switch(k){case b.seq_parameter_set_rbsp:g.endNalUnit(j.sps);break;case b.pic_parameter_set_rbsp:g.endNalUnit(j.pps);break;case b.slice_layer_without_partitioning_rbsp_idr:g.endNalUnit();break;default:g.endNalUnit()}return k=31&e[f],g&&(k===b.access_unit_delimiter_rbsp?this.finishFrame():k===b.slice_layer_without_partitioning_rbsp_idr&&(g.keyFrame=!0)),g||(g=new d(d.VIDEO_TAG),g.pts=a,g.dts=c),g.startNalUnit(),h=2,this.writeBytes(e,f,i)}}}}(this),function(a){var b=a.videojs.hls.FlvTag,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3];a.videojs.hls.AacStream=function(){var a,d,e,f,g,h,i,j,k,l,m,n,o;this.tags=[],this.setNextTimeStamp=function(b,c,g){d=b,this.setNextTimeStamp=function(b,c,g){a=b-d,f=c,g&&(e=0)},this.setNextTimeStamp(b,c,g)},this.writeBytes=function(d,p,q){var r,s,t;for(p=p||0,q=q||0,q=q>f?f:q,f-=q,r=p+q;r>p;)switch(e){default:e=0;break;case 0:if(p>=r)return;if(255!==d[p])return console.assert(!1,"Error no ATDS header found"),p+=1,void(e=0);p+=1,e=1;break;case 1:if(p>=r)return;if(240!==(240&d[p]))return console.assert(!1,"Error no ATDS header found"),p+=1,void(e=0);g=!!(1&d[p]),p+=1,e=2;break;case 2:if(p>=r)return;h=((192&d[p])>>>6)+1,i=(60&d[p])>>>2,j=(1&d[p])<<2,p+=1,e=3;break;case 3:if(p>=r)return;j|=(192&d[p])>>>6,k=(3&d[p])<<11,p+=1,e=4;break;case 4:if(p>=r)return;k|=d[p]<<3,p+=1,e=5;break;case 5:if(p>=r)return;k|=(224&d[p])>>>5,k-=g?7:9,p+=1,e=6;break;case 6:if(p>=r)return;l=1024*((3&d[p])+1),m=1e3*l/c[i],s=h<<11|i<<7|j<<3,s!==o&&(n=new b(b.METADATA_TAG),n.pts=a,n.dts=a,n.writeMetaDataDouble("audiocodecid",10),n.writeMetaDataBoolean("stereo",2===j),n.writeMetaDataDouble("audiosamplerate",c[i]),n.writeMetaDataDouble("audiosamplesize",16),this.tags.push(n),o=s,n=new b(b.AUDIO_TAG,!0),n.pts=n.dts,n.pts=a,n.view.setUint16(n.position,s),n.position+=2,n.length=Math.max(n.length,n.position),this.tags.push(n)),p+=1,e=7;break;case 7:if(!g){if(2>r-p)return;p+=2}n=new b(b.AUDIO_TAG),n.pts=a,n.dts=a,e=8;break;case 8:for(;k;){if(p>=r)return;t=k>r-p?r-p:k,n.writeBytes(d,p,t),p+=t,k-=t}this.tags.push(n),e=0,a+=m}}}}(this),function(a){var b,c,d=a.videojs,e=d.hls.FlvTag,f=d.hls.H264Stream,g=d.hls.AacStream;d.hls.SegmentParser=function(){var a,h=this,i=new Uint8Array(b),j=0,k=new f,l=new g;h.stream={programMapTable:{}},h.getFlvHeader=function(a,b,c){var d,f,g=new Uint8Array(9),h=new DataView(g.buffer);return a=a||0,b=void 0===b?!0:b,c=void 0===c?!0:c,h.setUint8(0,70),h.setUint8(1,76),h.setUint8(2,86),h.setUint8(3,1),h.setUint8(4,(b?4:0)|(c?1:0)),h.setUint32(5,g.byteLength),0>=a?(f=new Uint8Array(g.byteLength+4),f.set(g),f.set([0,0,0,0],g.byteLength),f):(d=new e(e.METADATA_TAG),d.pts=d.dts=0,d.writeMetaDataDouble("duration",a),f=new Uint8Array(g.byteLength+d.byteLength),f.set(h),f.set(h.bytesLength,d.finalize()),f)},h.flushTags=function(){k.finishFrame()},h.tagsAvailable=function(){return k.tags.length+l.tags.length},h.getNextTag=function(){var a;return a=k.tags.length?l.tags.length&&l.tags[0].dts<k.tags[0].dts?l.tags.shift():k.tags.shift():l.tags.shift(),a.finalize()},h.parseSegmentBinaryData=function(c){var e,f=0;if(j>0){if(c.byteLength+j<b)return d.log("data.length + streamBuffer.length < MP2T_PACKET_LENGTH ??"),void i.readBytes(c,c.length,i.length);e=c.subarray(0,b-j),i.set(e,j),a(i),i=new Uint8Array(b),j=0}for(;;){for(;f<c.byteLength&&71!==c[f];)f++;if(c.byteLength-f<b)return void(c.byteLength-f>0&&(i.set(c.subarray(f),j),j+=c.byteLength-f));a(c.subarray(f,f+b))?f+=b:(d.log("error parsing m2ts packet, attempting to re-align"),f++)}},a=function(a){var e,f,g,i,j,m,n,o,p,q,r,s,t,u,v,w=0,x=w+b,y=!!(64&a[w+1]),z=(31&a[w+1])<<8|a[w+2],A=(48&a[w+3])>>>4;if(w+=4,A>1&&(w+=a[w]+1),0===z){if(y&&(w+=1+a[w]),e=a[w],0!==e&&d.log("the table_id of the PAT should be 0x00 but was"+e.toString(16)),f=!!(1&a[w+5])){if(g=(15&a[w+1])<<8|a[w+2],w+=8,(g-5-4)/4!==1)throw new Error("TS has more that 1 program");h.stream.pmtPid=(31&a[w+2])<<8|a[w+3]}}else if(z===h.stream.programMapTable[c.h264]||z===h.stream.programMapTable[c.adts]){if(y){if(0!==a[w+0]||0!==a[w+1]||1!==a[w+2])throw new Error("PES did not begin with start code");i=a[w+4]<<8|a[w+5],j=0!==(4&a[w+6]),m=a[w+7],n=a[w+8],w+=9,192&m&&(o=(14&a[w+0])<<28|(255&a[w+1])<<21|(254&a[w+2])<<13|(255&a[w+3])<<6|(254&a[w+4])>>>2,o/=45,p=o,64&m&&(p=(14&a[w+5])<<28|(255&a[w+6])<<21|(254&a[w+7])<<13|(255&a[w+8])<<6|(254&a[w+9])>>>2,p/=45)),w+=n,z===h.stream.programMapTable[c.h264]?k.setNextTimeStamp(o,p,j):z===h.stream.programMapTable[c.adts]&&l.setNextTimeStamp(o,i,j)}z===h.stream.programMapTable[c.adts]?l.writeBytes(a,w,x-w):z===h.stream.programMapTable[c.h264]&&k.writeBytes(a,w,x-w)}else if(h.stream.pmtPid===z){if(y&&(w+=1+a[w]),2!==a[w]&&d.log("The table_id of a PMT should be 0x02 but was "+a[w].toString(16)),q=!!(1&a[w+5]))for(h.stream.programMapTable={},s=(15&a[w+1])<<8|a[w+2],r=(15&a[w+10])<<8|a[w+11],s-=r,s-=13,w+=12+r;s>0;){if(t=a[w+0],u=(31&a[w+1])<<8|a[w+2],t===c.h264){if(h.stream.programMapTable[t]&&h.stream.programMapTable[t]!==u)throw new Error("Program has more than 1 video stream");h.stream.programMapTable[t]=u}else if(t===c.adts){if(h.stream.programMapTable[t]&&h.stream.programMapTable[t]!==u)throw new Error("Program has more than 1 audio Stream");h.stream.programMapTable[t]=u}v=(15&a[w+3])<<8|a[w+4],w+=5+v,s-=5+v}}else 17===z||8191===z||d.log("Unknown PID parsing TS packet: "+z);return!0},h.getTags=function(){return k.tags},h.stats={h264Tags:function(){return k.tags.length},aacTags:function(){return l.tags.length}}},d.hls.SegmentParser.MP2T_PACKET_LENGTH=b=188,d.hls.SegmentParser.STREAM_TYPES=c={h264:27,adts:15}}(window),function(a){var b=function(){this.init=function(){var a={};this.on=function(b,c){a[b]||(a[b]=[]),a[b].push(c)},this.off=function(b,c){var d;return a[b]?(d=a[b].indexOf(c),a[b].splice(d,1),d>-1):!1},this.trigger=function(b){var c,d,e,f;if(c=a[b])for(f=Array.prototype.slice.call(arguments,1),e=c.length,d=0;e>d;++d)c[d].apply(this,f)}}};b.prototype.pipe=function(a){this.on("data",function(b){a.push(b)})},a.hls.Stream=b}(window.videojs),function(a,b,c,d){var e,f,g,h=function(){},i=function(a){for(var b,c=a.split(","),d=c.length,e={};d--;)b=c[d].split("="),b[0]=b[0].replace(/^\s+|\s+$/g,""),b[1]?(b[1]=b[1].replace(/^\s+|\s+$/g,""),-1!==b[1].indexOf('"')&&(b[1]=b[1].split('"')[1]),e[b[0]]=b[1]):c[d-1]=c[d-1]+","+b[0];return e},j=a.hls.Stream;e=function(){var a="";e.prototype.init.call(this),this.push=function(b){var c;for(a+=b,c=a.indexOf("\n");c>-1;c=a.indexOf("\n"))this.trigger("data",a.substring(0,c)),a=a.substring(c+1)}},e.prototype=new j,f=function(){f.prototype.init.call(this)},f.prototype=new j,f.prototype.push=function(a){var c,d;if(0!==a.length)return"#"!==a[0]?void this.trigger("data",{type:"uri",uri:a}):0!==a.indexOf("#EXT")?void this.trigger("data",{type:"comment",text:a.slice(1)}):(c=/^#EXTM3U/.exec(a))?void this.trigger("data",{type:"tag",tagType:"m3u"}):(c=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(a))?(d={type:"tag",tagType:"inf"},c[1]&&(d.duration=parseFloat(c[1],10)),c[2]&&(d.title=c[2]),void this.trigger("data",d)):(c=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(a))?(d={type:"tag",tagType:"targetduration"},c[1]&&(d.duration=b(c[1],10)),void this.trigger("data",d)):(c=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(a))?(d={type:"tag",tagType:"totalduration"},c[1]&&(d.duration=b(c[1],10)),void this.trigger("data",d)):(c=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(a))?(d={type:"tag",tagType:"version"},c[1]&&(d.version=b(c[1],10)),void this.trigger("data",d)):(c=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(a))?(d={type:"tag",tagType:"media-sequence"},c[1]&&(d.number=b(c[1],10)),void this.trigger("data",d)):(c=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(a))?(d={type:"tag",tagType:"playlist-type"},c[1]&&(d.playlistType=c[1]),void this.trigger("data",d)):(c=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(a))?(d={type:"tag",tagType:"byterange"},c[1]&&(d.length=b(c[1],10)),c[2]&&(d.offset=b(c[2],10)),void this.trigger("data",d)):(c=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(a))?(d={type:"tag",tagType:"allow-cache"},c[1]&&(d.allowed=!/NO/.test(c[1])),void this.trigger("data",d)):(c=/^#EXT-X-STREAM-INF:?(.*)$/.exec(a))?(d={type:"tag",tagType:"stream-inf"},c[1]&&(d.attributes=i(c[1]),d.attributes.RESOLUTION&&!function(){var a=d.attributes.RESOLUTION.split("x"),c={};a[0]&&(c.width=b(a[0],10)),a[1]&&(c.height=b(a[1],10)),d.attributes.RESOLUTION=c}(),d.attributes.BANDWIDTH&&(d.attributes.BANDWIDTH=b(d.attributes.BANDWIDTH,10)),d.attributes["PROGRAM-ID"]&&(d.attributes["PROGRAM-ID"]=b(d.attributes["PROGRAM-ID"],10))),void this.trigger("data",d)):(c=/^#EXT-X-ENDLIST/.exec(a))?void this.trigger("data",{type:"tag",tagType:"endlist"}):void this.trigger("data",{type:"tag",data:a.slice(4,a.length)})},g=function(){var a=this,b=[],i={};g.prototype.init.call(this),this.lineStream=new e,this.parseStream=new f,this.lineStream.pipe(this.parseStream),this.manifest={allowCache:!0},this.parseStream.on("data",function(e){({tag:function(){(({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var a={};"length"in e&&(i.byterange=a,a.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(i.byterange=a,a.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),e.duration>=0&&(i.duration=e.duration),this.manifest.segments=b},"media-sequence":function(){return c(e.number)?void(this.manifest.mediaSequence=e.number):void this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"playlist-type":function(){return/VOD|EVENT/.test(e.playlistType)?void(this.manifest.playlistType=e.playlistType):void this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},"stream-inf":function(){return this.manifest.playlists=b,e.attributes?(i.attributes||(i.attributes={}),void(i.attributes=d(i.attributes,e.attributes))):void this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},targetduration:function(){return!c(e.duration)||e.duration<0?void this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):void(this.manifest.targetDuration=e.duration)},totalduration:function(){return!c(e.duration)||e.duration<0?void this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):void(this.manifest.totalDuration=e.duration)}})[e.tagType]||h).call(a)},uri:function(){i.uri=e.uri,b.push(i),!this.manifest.targetDuration||"duration"in i||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),i.duration=this.manifest.targetDuration),i={}},comment:function(){}})[e.type].call(a)})},g.prototype=new j,g.prototype.push=function(a){this.lineStream.push(a)},g.prototype.end=function(){this.lineStream.push("\n")},window.videojs.m3u8={LineStream:e,ParseStream:f,Parser:g}}(window.videojs,window.parseInt,window.isFinite,window.videojs.util.mergeOptions);